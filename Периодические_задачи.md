# Периодические задачи относятся к задачам, которые должны выполняться регулярно или с определенным интервалом. Это могут быть повторяющиеся операции, обновления данных, синхронизация информации и другие действия, которые должны происходить в определенные моменты времени или через определенные промежутки времени.

В Celery вы можете настроить периодически выполняемые задачи (задачи по расписанию), которые будут запускаться автоматически через определенные интервалы времени. Это удобно при работе с задачами, которые должны выполняться регулярно: например, обновление кеша, отправка уведомлений и т. д.

Для начала установите дополнительный пакет celery-beat и добавьте его в установленные приложения:

```sh
$ pip install django-celery-beat
```

```sh
# settings.py
INSTALLED_APPS = [
    ...
    'django_celery_beat'
    ...
]
```

1. Рассмотрим, как происходит работа с периодическими задачами в Celery.

 Установка расписания Celery.
Чтобы использовать периодические задачи, нужно установить расписание Celery. Для этого добавьте следующую настройку в файл настроек Django 
[settings.py]():
```sh
# settings.py

# Настройки для Celery
CELERY_BEAT_SCHEDULE = {
    'task-name': {
        'task': 'myapp.tasks.my_task',  # Путь к задаче
        'schedule': timedelta(minutes=10),  # Расписание выполнения задачи (например, каждые 10 минут)
    },
}
```
В этом примере мы настраиваем задачу 'task-name', которая будет выполняться каждые 10 минут. Вы можете настроить несколько задач в 
CELERY_BEAT_SCHEDULE в соответствии с вашими потребностями.

2. Определение периодической задачи.
Затем нужно определить задачу, которую вы хотите выполнить периодически. Например:
```sh
from celery import shared_task

@shared_task
def my_task():
    # Код задачи
    pass
```
Здесь мы определяем задачу my_task, которая будет выполняться периодически в соответствии с расписанием, установленным в настройках.

3. Запуск Celery worker и планировщика Celery beat.
Чтобы использовать периодические задачи, нужно запустить не только Celery worker, но и планировщик Celery beat. Выполните следующую команду в командной строке:

```sh
celery -A my_project worker —loglevel=info
celery -A my_project beat —loglevel=info
```
Это запустит Celery worker и планировщик Celery beat, которые будут совместно работать для выполнения периодических задач.

Рассмотрим также пример с созданием задачи через модели:
```sh
import json
from datetime import datetime, timedelta

from django_celery_beat.models import PeriodicTask, \
    IntervalSchedule

# Создаем интервал для повтора 
schedule, created = IntervalSchedule.objects.get_or_create(
     every=10,
     period=IntervalSchedule.SECONDS,
 )

# Создаем задачу для повторения
PeriodicTask.objects.create(
     interval=schedule,
     name='Importing contacts',
     task='proj.tasks.import_contacts',
     args=json.dumps(['arg1', 'arg2']),
     kwargs=json.dumps({
        'be_careful': True,
     }),
     expires=datetime.utcnow() + timedelta(seconds=30)
 )
```

Теперь ваша периодическая задача будет выполняться автоматически в соответствии с заданным расписанием.

# Обратите внимание, что для использования периодических задач в Celery вы также должны настроить и использовать брокер сообщений, такой как RabbitMQ или Redis, для связи между Celery worker и планировщиком Celery beat.

Используйте документацию Celery для получения дополнительной информации о конфигурации и возможностях периодических задач.
